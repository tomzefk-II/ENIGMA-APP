<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link href="styles/styles.css" rel="stylesheet" type="text/css">
    <style>
      .loadingBar {
        position: absolute;
        transform: translate(0%, -100%);
        top: 95%;
        width: 0%;
        height: 25px;
        left: 5%;
        border: 2px solid #dbdbdb;
        border-radius: 5px;
        transition: 1s;
      }
      .loadingBar #loadingBarPercentage {
        width: 100%;
        line-height: 25px;
        text-align: center;
        font-weight: 400;
      }
    </style>
</head>
<body>
  <video id="intro" style="width: 100vw;" src="assets/intro/ENIGMA_intro.mp4" autoplay muted></video>
  <div id="loadingBar" class="loadingBar">
  <h6 id="loadingBarPercentage" class="text-grey p-0 m-0"></h6>
</div>
<script src="js/app.js"></script>
  <script>

  var mysql = require('mysql');
  let canRestart = 0;

  ipcRenderer.send('app_version');
  ipcRenderer.on('app_version', (event, arg) => {
    console.log("v" + arg.version)
  });

  initLoadingBarValue("checkingUpdates");

  ipcRenderer.on('update_available', () => {
    console.log("An update is available");
    ipcRenderer.removeAllListeners('update_available');
    console.log("Preparing for update...");
    localStorage.clear();
    var deleteIDB = indexedDB.deleteDatabase(dbName);
    deleteIDB.onsuccess = function(){
      canRestart = 1;
    }
  });

  ipcRenderer.on('update_downloaded', () => {
    console.log("The update has been downloaded");
    ipcRenderer.removeAllListeners('update_downloaded');
    console.log("Restarting");
    var restartInterval = setInterval(function(){
      if(canRestart = 1){
        ipcRenderer.send('restart_app');
      } else {
        console.log("Not ready to restart yet");
      }
    },1000);
  });

  ipcRenderer.on('update_not_available', () => {
    console.log("Update not available, proceeding with startup");
    ipcRenderer.removeAllListeners('update_not_available');
    initPWA();
  });

  ipcRenderer.on('error', () => {
    console.log("An error has happened");
    ipcRenderer.removeAllListeners('error');
  });

  goToNewWindow = function(){
    setTimeout(function(){
      const { ipcRenderer } = require('electron');
      ipcRenderer.send('open_login')
      setTimeout(function(){
        window.close();
      },500)
    },1500)
  }

  </script>
</body>
</html>
